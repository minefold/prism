#!/usr/bin/env ruby
# encoding: UTF-8
require 'bundler/setup'
Bundler.require :default

$:.unshift File.join File.dirname(__FILE__), '../lib'
require 'minefold'
require 'prism/back'

STDOUT.sync = true
EM.epoll

module Prism
  EM.run do
    puts "Started. #{Fold.env} mode"
    sweeper = Sweeper.new
    sweeper.perform_sweep
    EM.add_periodic_timer(3 * 60) { sweeper.perform_sweep }
    EM.add_periodic_timer(10)     { sweeper.record_stats }
  end
end