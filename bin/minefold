#!/usr/bin/env ruby
require 'bundler/setup'
Bundler.require :default, :cli

$:.unshift File.join File.dirname(__FILE__), '../lib'
require 'minefold'
require 'cli'

def usage
  puts <<-EOS
    usage: minefold <args>

      player:[username]
      player:[username] add-minutes:[amount]

      proxy tail-log

      world:[world_id]
      world:[world_id] download

      workers

      worker:[instance_id]
      worker:[instance_id] stop
      worker:[instance_id] terminate
EOS
end

abort usage unless ARGV.any?

args = ARGV.clone
args = ARGV.map {|a| a.split(':') }

resource_name, resource_id = args.shift

resource = case resource_name
when 'player'
  PlayerCommand.new resource_id
when 'world'
  WorldCommand.new resource_id
when 'worker'
  WorkerCommand.new resource_id
when 'workers'
  WorkersCommand.new
when 'proxy'
  ProxyCommand.new
else
  abort usage
end

while sub_cmd = args.shift
  command_name, *command_args = sub_cmd
  command_name = command_name.gsub /\-/, '_'
  resource.send command_name, *command_args
end

resource.show