#!/usr/bin/env ruby
require 'bundler/setup'
Bundler.require :default, :backup

$:.unshift File.join File.dirname(__FILE__), '../lib'
require 'environment'

# create a connection
connection = Fog::Compute.new({
  :provider                 => 'AWS',
  :aws_secret_access_key    => ENV['EC2_SECRET_KEY'],
  :aws_access_key_id        => ENV['EC2_ACCESS_KEY']
})

abort "Usage: stop-vm instance_id" unless ARGV.length == 1
instance_id = ARGV.shift

server = connection.servers.find {|s| s.id == instance_id }

if server
  puts "Stopping #{instance_id}"
  server.destroy
end